INSERT INTO "public"."receipts" ("id", "realtor_id", "client_name", "property_id", "amount_paid", "receipt_urls", "status", "created_at", "rejection_reason") VALUES ('190d4d27-bab1-4277-a81e-72df62665056', '957d85d4-77b2-40ee-b030-e565c1b1a5d2', 'Sayrah', '80956dc2-42fa-44e0-bd9a-25f3ed52a32d', '10000000', ARRAY["https://yeebxvkrxygkfxrbinny.supabase.co/storage/v1/object/public/receipt-uploads/957d85d4-77b2-40ee-b030-e565c1b1a5d2/1767555751837_zje2e7m.pdf"], 'approved', '2026-01-04 19:42:32.829067+00', null), ('27b63828-92f8-4aad-b344-c991cff21805', '8e549bde-02ae-4df4-a7e8-c9eca5598b18', 'Justine', '700dcefe-b03e-4b09-9f2a-6a525610b94e', '600000', ARRAY["https://yeebxvkrxygkfxrbinny.supabase.co/storage/v1/object/public/receipt-uploads/8e549bde-02ae-4df4-a7e8-c9eca5598b18/1767533722794_gdwurqq.pdf"], 'pending', '2026-01-04 13:35:24.67883+00', null), ('576c5d72-579d-4b9b-9081-8caa7cd0bffb', '4743d57e-789e-46c5-851d-22a8868507f2', 'Hodor', '80956dc2-42fa-44e0-bd9a-25f3ed52a32d', '1000000', ARRAY["https://yeebxvkrxygkfxrbinny.supabase.co/storage/v1/object/public/receipt-uploads/4743d57e-789e-46c5-851d-22a8868507f2/1767616856774_u36h0or.pdf"], 'approved', '2026-01-05 12:40:58.172411+00', null), ('6c7aeeb3-8264-4cf8-9c53-565982946d7e', '12787332-0a09-4701-95d4-5b5c103f1fcf', 'Kyle', '80956dc2-42fa-44e0-bd9a-25f3ed52a32d', '1000000', ARRAY["https://yeebxvkrxygkfxrbinny.supabase.co/storage/v1/object/public/receipt-uploads/12787332-0a09-4701-95d4-5b5c103f1fcf/1767614710459_8675nl0.pdf"], 'approved', '2026-01-05 12:05:12.449363+00', null), ('711995d7-3910-4a14-aaf6-690c5c937ac7', '957d85d4-77b2-40ee-b030-e565c1b1a5d2', 'Sayrah', '80956dc2-42fa-44e0-bd9a-25f3ed52a32d', '10000000', ARRAY["https://yeebxvkrxygkfxrbinny.supabase.co/storage/v1/object/public/receipt-uploads/957d85d4-77b2-40ee-b030-e565c1b1a5d2/1767555315101_dodr7eu.pdf"], 'approved', '2026-01-04 19:35:19.09135+00', null), ('764bf860-7789-4f7e-8529-db90155fc052', '4743d57e-789e-46c5-851d-22a8868507f2', 'Kon', '80956dc2-42fa-44e0-bd9a-25f3ed52a32d', '1000000', ARRAY["https://yeebxvkrxygkfxrbinny.supabase.co/storage/v1/object/public/receipt-uploads/4743d57e-789e-46c5-851d-22a8868507f2/1767617096427_4ip78g7.pdf"], 'approved', '2026-01-05 12:45:00.085551+00', null), ('841180de-1818-46d6-82ce-9a6ca086b051', 'd781bcbe-ee0f-4950-84d9-d5ee56ef36ed', 'Femi Teslim', '80956dc2-42fa-44e0-bd9a-25f3ed52a32d', '400000000', ARRAY["https://yeebxvkrxygkfxrbinny.supabase.co/storage/v1/object/public/receipt-uploads/d781bcbe-ee0f-4950-84d9-d5ee56ef36ed/1767441349126_n8mw8fi.pdf","https://yeebxvkrxygkfxrbinny.supabase.co/storage/v1/object/public/receipt-uploads/d781bcbe-ee0f-4950-84d9-d5ee56ef36ed/1767441351656_0o1wp39.pdf"], 'approved', '2026-01-03 11:56:01.100455+00', null), ('bb556fe2-d969-40e7-b856-1a2bd3c9a9af', 'f9e51c9a-3cd8-432c-9fd6-97ea76180494', 'Duke hagsweld', '700dcefe-b03e-4b09-9f2a-6a525610b94e', '600000', ARRAY["https://yeebxvkrxygkfxrbinny.supabase.co/storage/v1/object/public/receipt-uploads/f9e51c9a-3cd8-432c-9fd6-97ea76180494/1767376128336_24j1mfd.pdf"], 'approved', '2026-01-02 17:48:52.960011+00', null), ('c5a5cdc3-397b-4f08-9005-5b4ceabbd636', '3e5b64dc-902d-4a97-888d-ebc61b873fcc', 'Jonzz', '700dcefe-b03e-4b09-9f2a-6a525610b94e', '600000', ARRAY["https://yeebxvkrxygkfxrbinny.supabase.co/storage/v1/object/public/receipt-uploads/3e5b64dc-902d-4a97-888d-ebc61b873fcc/1767611835788_710dmlh.pdf"], 'rejected', '2026-01-05 11:17:17.319946+00', 'Invalid receipt'), ('fea803c5-9b8f-46f9-b12b-ade386394229', 'd781bcbe-ee0f-4950-84d9-d5ee56ef36ed', 'Emmanuel shokunmbi', '700dcefe-b03e-4b09-9f2a-6a525610b94e', '10000000', ARRAY["https://yeebxvkrxygkfxrbinny.supabase.co/storage/v1/object/public/receipt-uploads/d781bcbe-ee0f-4950-84d9-d5ee56ef36ed/1767552368072_rvlcad3.pdf","https://yeebxvkrxygkfxrbinny.supabase.co/storage/v1/object/public/receipt-uploads/d781bcbe-ee0f-4950-84d9-d5ee56ef36ed/1767552369083_ofh83a0.pdf"], 'approved', '2026-01-04 18:46:10.493862+00', null);


create table public.receipts (
  id uuid not null default extensions.uuid_generate_v4 (),
  realtor_id uuid null,
  client_name text not null,
  property_id uuid null,
  amount_paid numeric not null,
  receipt_urls text[] not null,
  status text null default 'pending'::text,
  created_at timestamp with time zone null default CURRENT_TIMESTAMP,
  rejection_reason text null,
  constraint receipts_pkey primary key (id),
  constraint receipts_property_id_fkey foreign KEY (property_id) references properties (id) on delete set null,
  constraint receipts_status_check check (
    (
      status = any (
        array[
          'pending'::text,
          'approved'::text,
          'rejected'::text,
          'under_review'::text
        ]
      )
    )
  )
) TABLESPACE pg_default;

create index IF not exists idx_receipts_realtor_id on public.receipts using btree (realtor_id) TABLESPACE pg_default;

create trigger trg_create_commissions_on_receipt_approved
after INSERT
or
update OF status on receipts for EACH row
execute FUNCTION create_commissions_on_receipt_approved ();

create trigger trg_notify_admin_receipt_pending
after INSERT
or
update OF status on receipts for EACH row
execute FUNCTION notify_admin_receipt_pending ();

create trigger trg_notify_receipt_updates
after INSERT
or
update OF status on receipts for EACH row
execute FUNCTION notify_receipt_updates ();


[
  {
    "policy_name": "receipts_insert_realtor_own",
    "operation": "INSERT",
    "applied_to": "{authenticated}",
    "using_expression": null,
    "check_expression": "(realtor_id = auth.uid())"
  },
  {
    "policy_name": "receipts_select_admin_all",
    "operation": "SELECT",
    "applied_to": "{authenticated}",
    "using_expression": "(EXISTS ( SELECT 1\n   FROM users u\n  WHERE ((u.id = auth.uid()) AND (u.role = 'admin'::text))))",
    "check_expression": null
  },
  {
    "policy_name": "receipts_select_realtor_own",
    "operation": "SELECT",
    "applied_to": "{authenticated}",
    "using_expression": "(realtor_id = auth.uid())",
    "check_expression": null
  },
  {
    "policy_name": "receipts_update_admin_all",
    "operation": "UPDATE",
    "applied_to": "{authenticated}",
    "using_expression": "(EXISTS ( SELECT 1\n   FROM users u\n  WHERE ((u.id = auth.uid()) AND (u.role = 'admin'::text))))",
    "check_expression": "(EXISTS ( SELECT 1\n   FROM users u\n  WHERE ((u.id = auth.uid()) AND (u.role = 'admin'::text))))"
  }
]


[
  {
    "users_table_foreign_keys": [
      {
        "local_table": "receipts",
        "local_column": "property_id",
        "referenced_table": "properties",
        "referenced_column": "id",
        "constraint_name": "receipts_property_id_fkey"
      }
    ]
  }
]